
# TraveRecorder（仮称）の設計を考えるの巻

トライブレコーダー。
あるいはトレイブレコーダー。
trade + drive recorder

## データ管理の仕組みをざっくり

入力されたデータは、1ツイあたりテキストベースで管理する。
で、タイムスタンプを使って昇順で1ファイルにまとめる機能があると、
色々捗る感じがある。
（あるいは1行目あたりにテキストデータでタイムスタンプを入れて、
それで並び替えをする。でも色々処理がめんどいと思う)

テキストファイルのデータの種類として、
「各局面でのコメント」
「トレード結果とコメント」
「総評」
あたりがあると良いと思う。

でも、別に1個のテキストボックスに好きに書き込めばいいじゃん、って気もするけど。
そうすると、トレード用ドライブレコだけじゃなく、汎用性が高まる。
だから、とりあえずベタなテキストファイルを排出して、
それを後でタイムスタンプ付きで、一個にまとめられるツールにすると良いかも。

## テキストファイルの構造について

いちおうテンプレファイルを用意して、それに沿って入力する形で、
別の格納方法を使いたくなったときのために「データの型」に
軽くハメておいた方が良いと思う。
そうすると、変換作業をする時に定形作業（つまりスクリプトで処理）
できるようになると思うぞ。

そのルールを破るやつは今の所自分だけなわけだし。

## データ格納の方法をざっくり

テキストファイルを1ツイごとに作る都合上、ディレクトリを
「西暦」
「月」
「週」<-これはいらんかも
「日」
で掘って、「日」ディレクトリ配下に配置するようにすれば良いと思う。

あとは、「テンプレフォルダ」「設定フォルダ」あたりを用意すればひとまずOKかと。
「設定フォルダ」というか、例えばbashを使うなら環境変数を読み込むファイル置き場みたいな。

というか、
この手のツールで昔は「カード型データベース」ってやつがあったような、
なかったような。ファイルメーカーだったっけ？
Unix系でそんな感じのツールがないか見ておいた方が良いかも。

## 開発環境についてざっくり

上記のデータ構造（要するに複数のテキストファイルを複数のディレクトリに配置する）ならば、
別にbashでもできるやん、って気がするというか、そこまで詳しくない言語の
ファイル操作の関数とかメソッドとかをいちいち調べてコーディングするより、
シェルコマンドをバリバリ使って古式ゆかしくCLIベースのツール群をbashで書いたほうが、
色々手を抜けそうな感じがある。

ひとまずほしいのは自分の思考と行動のデータを貯めるツールであって、
かっこいいプログラムではない。

sedで置換くらいなら、別に昔やっていたので全く問題ないし、
awkあたりになっちゃうとちょっときついかもしれないけど、
必要なら部分的にpythonなりrubyを使えばいいし。

これぞUnixじゃないすか。

## とりあえず書かないといけないプログラム

### 「インストール作業」をするプログラム

ディレクトリ掘ったりとか。
これはまだ要らない。

### 起動前チェックをするプログラム

環境変数が設定されてなかったら怒る処理と、
さらに個別の設定をする処理、
ディレクトリがなかったら、ひとまず掘る処理、
後述のヘッダフッタがなかったら、とりあえず作る処理、
を起動するプログラムが要らない？

これもまだ要らない？
ひとまず個別の設定と、
ディレクトリのチェックと、
ヘッダフッタのチェックは要るか。

### 個別の設定をするプログラム

この辺の扱いがあまり詳しくない。
いちおう、ディレクトリがどんな感じでほれている必要があるか、
テンプレディレクトリはどこにあるか、くらいの情報は必要。

### ディレクトリを掘るプログラム

前述のチェックプログラムがキックすると思うけど、
「日」ディレクトリがなかったら掘る、
「月」ディレクトリがなかったら掘る、
「西暦」ディレクトリがなかったら掘る、
という処理が必要かと。

で、とりあえずディレクトリを掘るプログラムが3つ要る。

だけど、bashだとチェックプログラムに直で書いても問題ない気がするので、
個別では書かない。

### ヘッダとフッタを作るプログラム

後述のマージするプログラムに直で書くのは嫌なので、
ひとまずヘッダとフッタを作るプログラムも書いておこう。
たぶん、その方が楽。

### テキストデータを書いてもらうプログラム

CLIベースなら、格納するディレクトリに、テンプレを必要なファイル名でコピーして、
emacsなりviなりをキックして編集してもらって、終わったら…今の所そのままでOKか。
ひとまずテンプレ指定するコマンドを作って、テンプレごとにそれをラップするコマンドを作る。

格納するファイル名に日付と秒単位の時刻（あるいは通番）が必要かと。
さらに、テキストファイルの行頭にタイムスタンプが必要かと。

起動前チェックのプログラムは起動しないといけない。

### 1つの日報ぽいファイルにまとめるプログラム

ひとまずファイル名で「日」ディレクトリにあるファイル名をソートして、
順番にくっつけていく。

とりあえず、ヘッダ（日々の記録 何月何日何曜日 とか）と、
フッタ（今の所必要そうな文言って「以上」くらい？）
も挿入できるようにした方が良いかも。
とりあえずで良いけど。

というか、こうなると「日報」ディレクトリがいるのか。
こういうのを環境変数でまとめておきたい。

## 開発作業について

とりあえず、俺プロジェクトで詳細設計を詰めてもしょうがないんで、
スパイラルモデルぽくコード書いてかねえ？って感じで。

とりあえず「テンプレから1ツイごとのファイルを作るプログラム」から書いてみて、
以降、

「チェックをするプログラム」
「ヘッダフッタのプログラム」
「マージをするプログラム」
「各種設定をするプログラム」

の順でやっていけば、そんなに苦労はないと思われる。
あと、足りない所をちょいちょい変更していく。
（これは1人とか、ごく少人数ならなんとか効く開発手法な気がする）
